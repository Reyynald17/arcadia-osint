<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcadia Admin | Secure Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
    <link rel="stylesheet" href="../style.css">
    <style>
        .glow-input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.4);
            border-color: #22d3ee;
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen flex items-center justify-center font-sans">

    <div class="w-full max-w-md p-8 border-2 border-cyan-400 rounded-[40px] bg-black shadow-[0_0_30px_rgba(34,211,238,0.2)]">
        <div class="text-center mb-8">
            <h1 class="font-bbh text-3xl text-cyan-400 uppercase tracking-widest">Admin Access</h1>
            <p class="text-xs text-gray-500 mt-2 uppercase">Arcadia Intelligence Division Only</p>
        </div>

        <form id="loginForm" class="space-y-6">
            <div>
                <label class="block text-xs font-bbh uppercase mb-2 text-gray-400">Agent Identifier</label>
                <input type="text" id="username" required
                    class="w-full bg-black border-2 border-gray-800 rounded-xl px-4 py-3 text-white glow-input transition-all">
            </div>

            <div>
                <label class="block text-xs font-bbh uppercase mb-2 text-gray-400">Encrypted Passkey</label>
                <input type="password" id="password" required
                    class="w-full bg-black border-2 border-gray-800 rounded-xl px-4 py-3 text-white glow-input transition-all">
            </div>

            <button type="submit" 
                class="w-full bg-cyan-500 hover:bg-cyan-400 text-black font-bbh py-3 rounded-xl transition-all duration-300 uppercase tracking-widest font-bold">
                Authenticate
            </button>
        </form>

        <div id="errorMessage" class="mt-4 text-red-500 text-xs text-center hidden">
            INVALID CREDENTIALS. ACCESS DENIED.
        </div>
    </div>

    <script>
        // Konfigurasi JSONBin (Sesuaikan dengan ID Bin Anda)
        const BIN_ID = '69538884ae596e708fb99e25'; 
        const API_KEY = '$2a$10$M55GAQGmXXRYA96RdrzW.uAiqpU.X2JqBMvXOyp0dDkE.4zO/0dfa';

        const loginForm = document.getElementById('loginForm');
        const errorMsg = document.getElementById('errorMessage');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;

            try {
                // Fetch data admin dari JSONBin
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { "X-Master-Key": API_KEY }
                });
                
                const data = await response.json();
                const admins = data.record.admins;

                // Cari admin yang sesuai
                const admin = admins.find(a => a.id === user);

                if (admin) {
                    // Verifikasi password dengan Hash Bcrypt
                    const isMatch = await dcodeIO.bcrypt.compare(pass, admin.password_hash);
                    
                    if (isMatch) {
                        // Set Session
                        sessionStorage.setItem("arcadia_auth", "authorized");
                        sessionStorage.setItem("agent_id", user);
                        window.location.href = "dashboard.html";
                    } else {
                        showError();
                    }
                } else {
                    showError();
                }
            } catch (err) {
                console.error(err);
                alert("Critical Error: Connection to database failed.");
            }
        });

        function showError() {
            errorMsg.classList.remove('hidden');
            setTimeout(() => errorMsg.classList.add('hidden'), 3000);
        }
    </script>
</body>
</html>